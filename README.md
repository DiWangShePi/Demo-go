# Demo-go

一个使用Gin构建的基础服务器，采用GORM与Postgresql数据库交互，JWT-GO用于鉴权，go-swagger生成api文档。

作为新手的一个简单Demo

docs部分是swagger生成的文档，global部分包含运行过程中需要用到的全局变量，initialize部分负责服务器初始化，middleware是代码在客户和具体的handler之间的处理函数，router负责路由，services处理具体的请求，table包含与数据库交互的函数，test是测试代码，utils包含需要用到的小块代码。

#### Quick Start

请在config.json中设置好与数据库连接的相关参数，随后启动程序

```
go run main.go
```

服务器默认运行在本地，监听9090端口。

#### Function

按照[‌﻿‬⁣﻿⁤‍‌﻿⁤﻿⁢‬⁢⁤‍⁢⁢‌﻿﻿﻿‍⁡﻿‌‌⁣‬‬‍﻿﻿⁢‌‍﻿⁣⁣新手 Demo 项目标准 - 飞书云文档 (feishu.cn)](https://blankspace.feishu.cn/wiki/OK0fwPJ5EidlKEkcPNlcXGaonoh)中的要求，可在运行起来后访问http://localhost:9090/swagger/index.html查看API文档

#### To be continue

针对已有的工程，存在诸多可以改进的地方，但出于时间的限制，这些功能尚未完成，本节简要描述我对这个项目现有问题的分析及解决思路。

###### 缺少注释

这本身是一个很简略的Demo，所以我在写代码的过程中也没有费心写详细的注释。我想这些简单的代码应该可以解释自己了。不过如果有多的时间，加一些注释会更好。

###### Config部分不够全面

部分参数的初始化可以被写入到config中，比如token的延迟时间，或者是服务器的监听端口。将这部分一起纳入到config文件的覆盖范围会更有利于服务器的调度规划，避免隐含的bug。

###### JWT鉴权

目前的功能仅能支持简单的生成和携带token，尚未考虑因更换密码或长期未操作导致的token过期情况。由于JWT本身是无状态的，不会存储用户的token，服务端无法让 token 提前过期。在用户修改密码后，可以在返回的消息中包含重新生成的token，要求前端配合更新token。或者，可以在本地维护token的黑/白名单，在用户更新密码或进行其他需要更新token的操作时，添加/删除掉旧的token,从而让用户在下一次请求的时候强制重新请求token。

针对黑/白名单，我个人更偏向于白名单，这样在服务器运行的时候，只需要维护与用户数量同样的token数目（在不考虑一个账户多点登录的前提下）。但对于黑名单，我需要一直维护已经废弃的token，如果我删除了其中的一部分，就存在安全漏洞，恶意者可以将很久以前的本应过期的token拿做“合法”token。

不过，这些同样有对应的策略，这里我仅就单纯的黑白名单做讨论。

###### 输入验证

缺乏对用户输入数据的验证部分，比如合法的用户ID等，不过Demo中并未提出类似要求，所以并未准备相应的处理。这一部分的实现可以在GROM的部分添加。

###### 代码重构

代码存在大量的重复使用，存在重构优化的空间，比如services下的代码及test下的代码。